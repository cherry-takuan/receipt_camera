<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Web Serial API 送信デモ</title>
</head>
<body>
    <h1>Web Serial 送信デモ</h1>
    <button id="connectButton">シリアルポートに接続</button>
    <button id="sendButton" disabled>データ送信 ('Hello!')</button>
    <button id="disconnectButton" disabled>切断</button>
    <p id="statusMessage">状態: 未接続</p>

    <script type="module">
        import { connectSerialPort, sendData, disconnectSerialPort } from './serialSender.js';

        const connectButton = document.getElementById('connectButton');
        const sendButton = document.getElementById('sendButton');
        const disconnectButton = document.getElementById('disconnectButton');
        const statusMessage = document.getElementById('statusMessage');

        connectButton.addEventListener('click', async () => {
            statusMessage.textContent = '状態: 接続中...';
            const connected = await connectSerialPort();
            if (connected) {
                statusMessage.textContent = '状態: 接続済み';
                connectButton.disabled = true;
                sendButton.disabled = false;
                disconnectButton.disabled = false;
            } else {
                statusMessage.textContent = '状態: 接続失敗またはキャンセル';
                connectButton.disabled = false;
                sendButton.disabled = true;
                disconnectButton.disabled = true;
            }
        });

        sendButton.addEventListener('click', async () => {
            // 送信するデータ。デバイスの要件に合わせて改行文字 (\r\n など) を含めることが推奨されます。
            const data = '\x1B@Hello from Web App!\n'; 
            const sent = await sendData(data);
            if (sent) {
                // 送信後のUI更新などはここでは省略
            }
        });

        disconnectButton.addEventListener('click', async () => {
            await disconnectSerialPort();
            statusMessage.textContent = '状態: 未接続';
            connectButton.disabled = false;
            sendButton.disabled = true;
            disconnectButton.disabled = true;
        });

    </script>
</body>
</html>