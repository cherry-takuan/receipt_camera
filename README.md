# 📷レシートカメラ / Receipt Camera

このプロジェクトは、ブラウザに接続されたWebカメラの映像をリアルタイムでアスキーアート化し、その画像をシリアルポート（Web Serial API経由）を通じてレシートプリンターなどの機器に送信するWebアプリケーションです。

特に、印刷機材の制約（32文字 x 可変長）に合わせて、カメラ映像の縦横を入れ替えて（転置して）AAデータを生成し、シリアル送信する点が特徴です。

## 🚀技術スタック (Technology Stack)


| カテゴリ | 技術 | 概要 |
| --- | --- | --- |
| フロントエンド | HTML5 CSS | UI/UX構築 |
| コアロジック | JavaScript (ES Modules) | カメラ制御、AA変換、シリアル通信処理 |
| ブラウザAPI | Web Serial API | シリアルポートとの接続およびデータ送信 |
| メディアAPI | MediaDevices API | Webカメラのストリーム取得および設定制御 (getUserMedia| applyConstraints)|
| 画像処理 | Canvas API | 映像フレームのキャプチャ、縮小、ピクセルデータ取得|


## 🌟主な機能 (Features)
- リアルタイムAA変換: Webカメラの映像（48x32ピクセルに縮小）をリアルタイムでAA化し、画面に表示します。

- 印刷機対応のデータ転置: 32文字幅のプリンターに適合させるため、AAデータを縦横転置（元画像のXを印刷の行、元のYを印刷の列とする、48行 x 32文字）して生成します。

- シリアル通信: Web Serial API を利用し、指定したシリアルポートにAAデータを送信します。

- プリンター制御: ESC/POSプロトコルを使用し制御を行います。

- カメラ設定制御: Webカメラの露出時間 (exposureTime) やコントラスト (contrast) の設定を試み、映像品質を調整できます（うまく動かないので後で直す）。

## 📂ディレクトリ構成
```
web-serial-aa-printer/
├── index.html            # メインページ (UI、HTML構造、イベントリスナーを統合)
├── asciiConverter.js     # AA生成、二値化、転置ロジック、印刷処理を含むコアモジュール
├── cameraFeed.js         # Webカメラの起動、停止、設定制御を担うモジュール
└── serialSender.js       # Web Serial APIによる接続、切断、データ送信を担うモジュール
```

## 💡使い方 (Usage)
### 動作環境
- ブラウザ: Web Serial API をサポートする最新版の Google Chrome または Microsoft Edge が必須です。

- 接続: レシートプリンターなどのシリアル機器がPCにUSBまたはシリアルポート経由で接続されている必要があります。

### 実行手順
1. ここにアクセス

1. シリアルポートに接続:

    `[シリアルポートに接続]` ボタンをクリックし、表示されたダイアログから対象のデバイスを選択して接続します。

    状態が「接続済み」になることを確認してください。

1. カメラを起動:

    `[カメラを起動]` ボタンをクリックし、カメラへのアクセスを許可します。

1. AA変換開始と調整:

    `[AA変換開始]` ボタンをクリックすると、カメラ映像がリアルタイムでAAに変換され、画面に表示されます。

    必要に応じて「露出時間」や「コントラスト」の設定を試みてください。

1. 印刷:

    `[AAを印刷機へ送信]` ボタンをクリックすると、現在画面に表示されているAAデータが \x1B@ コマンドと共にシリアルポートに送信されます。